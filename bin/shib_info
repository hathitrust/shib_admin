#!/usr/bin/env ruby

require 'optparse'
require_relative '../lib/metadata.rb'

# get args
verbose = false
OptionParser.new do |opts|
  opts.banner = <<usage

Usage: shib_info [-v] [ entityID_substring ]

Prints a list of possible entityID matches, or additional information on the
entitly if there is exactly one match.

Use without options to see full list of InCommon IdPs.

usage

  opts.on("-v", "Print XML dump of full EntityDescriptor") do |v|
    verbose = v
  end

end.parse!

q = ARGV[0]

eids = get_entityIDs(q)

# no match
if eids.size < 1
  puts "#{q}: no match"
# many matches, list hits
elsif eids.size > 1
  puts eids
# one match, print IdP info
else
  info = get_entity_info(q)

  puts "EntityID: #{info[:entityID]}"
  if(info[:support_contacts])
    puts "Support Contact: #{info[:support_contacts].join(', ')}"
  else
    puts "NO SUPPORT CONTACT"
  end

  if(info[:technical_contacts])
    puts "Technical Contact: #{info[:technical_contacts].join(', ')}"
  else
    puts "NO TECHNICAL CONTACT"
  end

  if verbose
    puts 'EntityDescriptor:'
    puts get_EntityDescriptor(q)
  end
end
